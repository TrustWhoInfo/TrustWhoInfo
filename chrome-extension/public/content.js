(()=>{"use strict";class e{constructor(e,t,n,s){this.url=e,this.media=t,this.author=n,this.subjects=s||[]}}class t{static setEnabled(e){t.enabled=e}static setCode(e){t.code=e}}t.enabled=!0,t.code="";const n="tass.ru";class s extends class{install(){}uninstall(){}async getTrustLevels(e){return await class{static async postData(e="",t={}){try{const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await n.text();return{ok:!0,data:JSON.parse(s)}}catch(e){return{ok:!1,error:e}}}static async getTrustLevels(e,t){return this.postData("https://localhost:7071/api/trustLevel",{code:e,news:t})}}.getTrustLevels(t.code,e)}levelColor(e){return`hsl(${0+(e+100)/200*114}deg, 100%, 50%)`}createPreviewIndicator(e){const t=document.createElement("div");return t.classList.add("twi-icon-prepend"),t.style.marginTop="4px",t.textContent="Trust level: "+(e>0?`+${e}`:e<0?`${e}`:"0"),t.style.color=this.levelColor(e),t.style.textShadow="1px 1px 1px #888",t}}{install(){this.addPreviewIndicators(),this.addNewsIndicator()}async addNewsIndicator(){const e=document.querySelectorAll(".news");for(let t=0;t<e.length;++t){const n=e[t],s=this.getNews(n),o=await this.getTrustLevels([s]);if(o.ok&&o.data.ok){const e=o.data.levels[0],t=this.createPreviewIndicator(e),s=n.querySelector(".news-header__top");s&&s.appendChild(t)}}}getSubjectsFromUrl(e){if(!e)return[];const t=e.indexOf(n+"/")+n.length+1,s=e.indexOf("/",t+1);return[e.substr(t,s-t)]}getNews(t){const s=t.dataset.ioArticleUrl;console.log(t,s);const o=this.getSubjectsFromUrl(s);return new e(s,n,null,o)}async addPreviewIndicators(){const t=document.querySelectorAll("a.news-preview"),s=[];for(let o=0;o<t.length;++o){const a=t[o].href,r=this.getSubjectsFromUrl(a);s.push(new e(a,n,null,r))}const o=await this.getTrustLevels(s);if(o.ok&&o.data.ok)for(let e=0;e<t.length;++e){const n=o.data.levels[e],s=t[e],a=this.createPreviewIndicator(n),r=s.querySelector(".news-preview__body");r&&r.appendChild(a)}}}const o={"tass.ru":()=>new s},a=class{static get(e){const t=o[e];return t?t():null}}.get(location.hostname);function r(){a&&(function(){const e=document.createElement("style");e.textContent="\n.twi-icon-prepend:before {\n    content: ' ';\n    width: 16px;\n    height: 16px;\n    display: inline-block;\n    margin-right: 4px;\n    position: relative;\n    top: 2px;    \n    background: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJgSURBVDhPvVNLaxNRFL73ziOXGE3aZBEli4D9AT4SjeZZjVBxqV0IXQQMuHTtwoVIQXDRboVIkbroUqFCVyahSVski0BqH7HF58KmQdI82kxn5o7njuPYWsGdH5yZM2fOd+6Zc75B/x0fPn+hK/W6x3pE2Lr/FW8rFY8giL5etxvQNDWl63rUMIyYKIqFK8PD13nOkQKr9feu7cZWRFPVpKZpWabrfowxIoKwRohQQMgISrLjaSIWfcnz7QJv8oU0Y/ojIIQMhERCSBVOG2KM0UGv99KFUKhSW1mlUHyaYKylksnbnEdMNoAQzEkadTpH3QODA9fS6bOCIExSSpc4mec0G1sZiD2Dc9fzxeIZk8cvHEBGcKLP6To+GwmHWlZYB9O48259XQTi1WQ8PnfM5ZqE3Hs8bhdgzLgjy46HnZ3WmBU6hHarNQKjeM798PlzLehks1qrBc0CpYWFlM70cjwWnYE2bvDYn+DDhI3cnC+VpsqLi1MGY6fbO+2AWUBV1btery/HfUzIq3yheIv7B6FqWl/dVzKiJGUIJhlFUcZEUWiRzY+fqNvtfu2g1AcrDPpPnlo64XHD9x5GKpF4gTC+3+10vna7nTVJkkYvRyLLYnO7Edjt9abBEAgFCTBMnTHYN5r5Sf0NEM9juHGzQS6Gwxuwgdze7h4C8aC+ovShm3Hr/T9hC2m+XB6BAkOyg85KktiEVp9ARxGMsJ8IZA4GOJ5MxDesdBtHpFytLbu+N5vZfaU/YYVMyJTm4B94kIjFvlkhE7YOfgF0EEMGm5BlGR00EEoWxJO10iwg9AOAXfk4S3Pt+QAAAABJRU5ErkJggg==\");\n}\n",e.id="twi-css",document.head.appendChild(e)}(),a.install())}function c(){a&&(function(){const e=document.getElementById("twi-css");e&&e.remove()}(),a.uninstall())}function i(){chrome.storage.sync.get(["enabled","code"],(function(e){t.setEnabled(e.enabled),t.setCode(e.code),e.enabled?r():c()}))}chrome.runtime.onMessage.addListener((function(e,t,n){"init"===e.command?r():c(),n({result:"success"})})),"loading"!=document.readyState?i():window.addEventListener("DOMContentloaded",i)})();